<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Diário Digital — Controle de Presença</title>
  <style>
    :root{
      --bg:#f7f9fc; --surface:#ffffff; --text:#1f2937; --muted:#6b7280; --primary:#2563eb; --primary-600:#1d4ed8; --ring:#93c5fd; --danger:#ef4444; --success:#16a34a; --warning:#f59e0b;
      --border:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}
    .app{
      display:flex;min-height:100vh;flex-direction:column;
    }
    header{
      position:sticky;top:0;background:var(--surface);border-bottom:1px solid var(--border);z-index:10
    }
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 16px;max-width:1100px;margin:0 auto}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .brand .dot{width:10px;height:10px;border-radius:999px;background:var(--primary);box-shadow:0 0 0 6px rgba(37,99,235,.15)}
    .nav{display:flex;gap:8px;flex-wrap:wrap}
    .nav a{padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:var(--surface)}
    .nav a.active{background:var(--primary);color:#fff;border-color:transparent}
    .user{display:flex;align-items:center;gap:8px;color:var(--muted)}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer;transition:transform .05s ease, box-shadow .2s ease}
    .btn:hover{box-shadow:0 6px 20px rgba(0,0,0,.06)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:var(--primary);color:#fff;border-color:transparent}
    .btn.ghost{background:transparent}

    main{max-width:1100px;margin:20px auto;padding:0 16px;flex:1;width:100%}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:16px;box-shadow:0 8px 30px rgba(0,0,0,.04);overflow:hidden}
    .card .head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
    .card .body{padding:16px}
    .muted{color:var(--muted)}

    .grid{display:grid;gap:12px}
    @media(min-width:768px){.grid.cols-2{grid-template-columns:1fr 1fr}}

    .input, select, textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:var(--surface);outline:none}
    .input:focus, select:focus, textarea:focus{box-shadow:0 0 0 4px var(--ring);border-color:var(--primary)}
    label{font-size:.9rem;color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

    table{width:100%;border-collapse:collapse}
    th, td{padding:10px;border-bottom:1px solid var(--border);text-align:left;vertical-align:middle}
    th{font-size:.9rem;color:var(--muted);font-weight:600;background:#fafafa}
    tr:hover td{background:#fafbff}

    .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;border:1px solid var(--border);background:#fff;font-size:.8rem}
    .badge.success{border-color:#bbf7d0;background:#ecfdf5;color:#065f46}
    .badge.warn{border-color:#fde68a;background:#fffbeb;color:#92400e}
    .badge.muted{background:#f3f4f6;color:#374151}

    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size:.8rem;background:#111827;color:#e5e7eb;padding:3px 6px;border-radius:6px}

    .toolbar{display:flex;gap:8px;flex-wrap:wrap}

    /* Modal */
    dialog{border:none;border-radius:16px;box-shadow:0 20px 80px rgba(0,0,0,.2);width:min(680px,92vw)}
    dialog::backdrop{background:rgba(2,6,23,.45)}

    /* Mobile cards for tables */
    @media(max-width:720px){
      table thead{display:none}
      table, tbody, tr, td{display:block;width:100%}
      tr{border:1px solid var(--border);border-radius:12px;margin-bottom:10px;background:#fff}
      td{border-bottom:1px dashed var(--border);padding:10px 12px}
      td:last-child{border-bottom:none}
      td::before{content:attr(data-label);display:block;font-size:.8rem;color:var(--muted);margin-bottom:6px}
    }

    /* Tiny animations */
    .fade-in{animation:fade .25s ease}
    @keyframes fade{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}

    .status-dot{width:8px;height:8px;border-radius:999px;display:inline-block}
    .status-frequente{background:var(--success)}
    .status-afastado{background:var(--danger)}
    .status-licenca{background:var(--warning)}

    footer{padding:24px 16px;color:var(--muted);text-align:center}
  </style>
</head>
<body>
<div class="app" id="app">
  <header>
    <div class="topbar">
      <div class="brand"><span class="dot"></span> Diário Digital</div>
      <nav class="nav" id="nav"></nav>
      <div class="user" id="userBox"></div>
    </div>
  </header>

  <main>
    <!-- LOGIN -->
    <section id="view-login" class="card fade-in" hidden>
      <div class="head"><strong>Entrar</strong><span class="muted">Acesse com seu e-mail</span></div>
      <div class="body">
        <form id="loginForm" class="grid cols-2" autocomplete="on">
          <div class="grid"><label>E-mail</label><input class="input" type="email" name="email" required placeholder="voce@exemplo.com"></div>
          <div class="grid"><label>Senha</label><input class="input" type="password" name="password" required placeholder="••••••••"></div>
          <div class="row" style="grid-column:1/-1;justify-content:space-between">
            <div class="muted">Dica: use <span class="kbd">demo@demo.com</span> / <span class="kbd">demo123</span></div>
            <button class="btn primary" type="submit">Entrar</button>
          </div>
        </form>
      </div>
    </section>

    <!-- PRINCIPAL: MEMBROS -->
    <section id="view-members" class="fade-in" hidden>
      <div class="card">
        <div class="head">
          <div class="row"><strong>Lista de Membros</strong><span class="badge muted" id="membersCount">0 membros</span></div>
          <div class="toolbar">
            <input class="input" id="memberSearch" placeholder="Pesquisar por nome..." />
            <button class="btn" id="btnNewMember">+ Cadastrar membro</button>
          </div>
        </div>
        <div class="body">
          <div class="muted" style="margin-bottom:10px">Colunas: <strong>Nome</strong>, <strong>Cargos</strong>, <strong>Editar situação</strong></div>
          <div style="overflow:auto">
            <table id="membersTable">
              <thead>
                <tr><th>Nome do Membro</th><th>Cargos</th><th>Situação</th><th>Ações</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- LISTA DE PRESENÇA -->
    <section id="view-attendance" class="fade-in" hidden>
      <div class="card">
        <div class="head">
          <strong>Lista de Presença</strong>
          <div class="toolbar">
            <select id="attendanceDate" title="Datas (apenas domingos)"></select>
            <button class="btn" id="btnLoadAttendance">Carregar</button>
            <button class="btn primary" id="btnSaveAttendance">Salvar presenças</button>
          </div>
        </div>
        <div class="body">
          <p class="muted">Regra: <em>Licença</em> aparece aqui como inativo. <em>Afastado</em> não aparece na chamada.</p>
          <div style="overflow:auto">
            <table id="attendanceTable">
              <thead>
                <tr><th>Nome</th><th>Situação</th><th>Presença</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- FILTROS DE PRESENÇA -->
    <section id="view-filters" class="fade-in" hidden>
      <div class="card">
        <div class="head">
          <strong>Filtros de Presença</strong>
          <div class="toolbar"><button id="btnRunFilters" class="btn">Aplicar filtros</button></div>
        </div>
        <div class="body">
          <div class="grid cols-2">
            <div>
              <label>Data (Domingos)</label>
              <select id="filterDate"></select>
            </div>
            <div>
              <label>Status de presença</label>
              <select id="filterPresence">
                <option value="">Todos</option>
                <option value="P">Presente</option>
                <option value="F">Falta</option>
                <option value="FJ">Falta Justificada</option>
              </select>
            </div>
            <div>
              <label>Cargo</label>
              <input id="filterRole" class="input" placeholder="Ex.: Professor" />
            </div>
            <div>
              <label>Nome contém</label>
              <input id="filterName" class="input" placeholder="Buscar por nome" />
            </div>
          </div>
          <div style="margin-top:14px;overflow:auto">
            <table id="filtersResult">
              <thead><tr><th>Data</th><th>Nome</th><th>Cargos</th><th>Presença</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

  </main>

  <footer>
    <small>© 2025 Diário Digital. Interface responsiva com HTML, CSS e JS puro.</small>
  </footer>
</div>

<!-- DIALOG: NOVO/EDITAR MEMBRO -->
<dialog id="memberDialog">
  <form method="dialog" id="memberForm" class="grid" style="padding:18px">
    <h3 id="memberDialogTitle" style="margin:0">Cadastrar membro</h3>
    <input type="hidden" id="memberId" />
    <div class="grid">
      <label>Nome</label>
      <input id="memberName" class="input" required placeholder="Nome completo" />
    </div>
    <div class="grid">
      <label>Cargos (selecione um ou mais)</label>
      <div id="rolesArea" class="row" style="gap:10px;flex-wrap:wrap"></div>
    </div>
    <div class="grid">
      <label>Situação</label>
      <select id="memberStatus">
        <option value="frequente">Frequente</option>
        <option value="afastado">Afastado</option>
        <option value="licenca">Licença</option>
      </select>
    </div>
    <div class="row" style="justify-content:flex-end;margin-top:8px">
      <button class="btn ghost" value="cancel">Cancelar</button>
      <button class="btn primary" value="default">Salvar</button>
    </div>
  </form>
</dialog>

<script>
/**
 * SPA super simples com hash routing (#/login, #/members, #/attendance, #/filters)
 *
 * \u26a0\ufe0f PONTOS DE INTEGRAÇÃO COM O BACKEND (rotas REST/JSON sugeridas):
 * - POST   /api/auth/login            { email, password } => { token, user }
 * - GET    /api/users/me              Authorization: Bearer <token>
 * - GET    /api/members               => [{ id, name, roles:[...], status, createdAt }]
 * - POST   /api/members               { name, roles:[], status } => { id }
 * - PUT    /api/members/:id           { name, roles:[], status }
 * - GET    /api/attendance?date=YYYY-MM-DD  => [{ memberId, presence: 'P'|'F'|'FJ' }]
 * - PUT    /api/attendance/:date      { entries:[{ memberId, presence }] }
 * - GET    /api/roles                 => ["Professor","Líder","Aluno",...]
 *
 * Observação: Aqui simulamos com armazenamento local (localStorage) e mocks.
 */

// ======= Estado global =======
const state = {
  token: null,
  user: null,
  members: [],
  roles: ["Professor","Líder","Aluno","Auxiliar","Visitante"],
  attendanceByDate: {}, // { '2025-08-10': { memberId: 'P'|'F'|'FJ' } }
};

// Utilitários
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const fmt = {
  date(d){return new Date(d).toISOString().slice(0,10)}
}

// Persistência local (simula DB)
const storage = {
  save(){ localStorage.setItem('diario.state', JSON.stringify({members: state.members, attendanceByDate: state.attendanceByDate})) },
  load(){ const raw = localStorage.getItem('diario.state'); if(raw){ try{ const {members, attendanceByDate} = JSON.parse(raw); state.members = members||[]; state.attendanceByDate = attendanceByDate||{}; }catch(e){} } }
}

// Mock inicial (apenas na primeira vez)
function ensureSeed(){
  if(!localStorage.getItem('diario.seeded')){
    state.members = [
      {id: crypto.randomUUID(), name:'Ana Clara', roles:['Aluno'], status:'frequente', createdAt: fmt.date(new Date())},
      {id: crypto.randomUUID(), name:'Bruno Lima', roles:['Professor','Líder'], status:'frequente', createdAt: fmt.date(new Date())},
      {id: crypto.randomUUID(), name:'Carla Souza', roles:['Auxiliar'], status:'licenca', createdAt: fmt.date(new Date())},
      {id: crypto.randomUUID(), name:'Diego Alves', roles:['Aluno'], status:'afastado', createdAt: fmt.date(new Date())},
    ];
    state.attendanceByDate = {};
    storage.save();
    localStorage.setItem('diario.seeded','1');
  }
}

// ======= Router =======
const routes = ['login','members','attendance','filters'];
function setActiveNav(hash){
  $$('#nav a').forEach(a=>a.classList.toggle('active', a.getAttribute('href')===hash));
}
function renderNav(){
  const nav = $('#nav');
  nav.innerHTML = '';
  if(!state.token){ return; }
  const links = [
    ['#/members','Membros'],
    ['#/attendance','Lista de Presença'],
    ['#/filters','Filtros']
  ];
  links.forEach(([href,label])=>{
    const a = document.createElement('a'); a.href = href; a.textContent = label; nav.appendChild(a);
  });
}
function show(view){
  routes.forEach(v=>{ const el = $('#view-'+v); if(el) el.hidden = true; });
  const target = $('#view-'+view); if(target) target.hidden = false;
  setActiveNav('#/'+view);
}
function navigate(){
  const hash = location.hash || '#/login';
  const view = hash.replace('#/','');
  if(!state.token && view!== 'login'){ location.hash = '#/login'; return; }
  switch(view){
    case 'login': show('login'); break;
    case 'members': renderMembers(); show('members'); break;
    case 'attendance': renderAttendanceDates(); show('attendance'); break;
    case 'filters': renderFilterDates(); show('filters'); break;
    default: location.hash = '#/members';
  }
}
window.addEventListener('hashchange', navigate);

// ======= Autenticação (mock) =======
function renderUserBox(){
  const box = $('#userBox');
  if(state.token){
    box.innerHTML = `<span class="muted">${state.user?.email||'usuário'}</span> <button class="btn" id="btnLogout">Sair</button>`;
    $('#btnLogout')?.addEventListener('click', ()=>{ state.token=null; state.user=null; renderNav(); navigate(); renderUserBox(); });
  } else {
    box.innerHTML = '';
  }
}
$('#loginForm').addEventListener('submit', (e)=>{
  e.preventDefault();
  const fd = new FormData(e.target);
  const email = fd.get('email'); const password = fd.get('password');
  // \u27a4 Backend real: POST /api/auth/login {email,password}
  if(email && password){
    state.token = 'mock-token';
    state.user = { id:'1', name:'Demo', email };
    renderNav(); renderUserBox(); location.hash = '#/members';
  }
});

// ======= Membros =======
function renderMembers(){
  const tbody = $('#membersTable tbody');
  const query = $('#memberSearch').value.toLowerCase();
  const filtered = state.members.filter(m=>m.name.toLowerCase().includes(query));
  $('#membersCount').textContent = `${filtered.length} membro(s)`;
  tbody.innerHTML = '';
  filtered.forEach(m=>{
    const tr = document.createElement('tr');
    const rolesBadges = m.roles.map(r=>`<span class="badge">${r}</span>`).join(' ');
    const statusBadge = {
      'frequente': `<span class="badge success"><span class="status-dot status-frequente"></span>Frequente</span>`,
      'afastado': `<span class="badge"><span class="status-dot status-afastado"></span>Afastado</span>`,
      'licenca': `<span class="badge warn"><span class="status-dot status-licenca"></span>Licença</span>`
    }[m.status] || '';
    tr.innerHTML = `
      <td data-label="Nome">${m.name}</td>
      <td data-label="Cargos">${rolesBadges||'<span class=muted>—</span>'}</td>
      <td data-label="Situação">${statusBadge}</td>
      <td data-label="Ações"><button class="btn" data-edit="${m.id}">Editar</button></td>
    `;
    tbody.appendChild(tr);
  });
  $$('button[data-edit]').forEach(b=>b.addEventListener('click',()=>openMemberDialog(b.dataset.edit)));
}
$('#memberSearch').addEventListener('input', renderMembers);
$('#btnNewMember').addEventListener('click', ()=>openMemberDialog());

function openMemberDialog(id){
  const dlg = $('#memberDialog');
  const editing = !!id;
  $('#memberDialogTitle').textContent = editing? 'Editar membro' : 'Cadastrar membro';
  $('#memberId').value = id||'';
  // Roles checkboxes
  const rolesArea = $('#rolesArea'); rolesArea.innerHTML = '';
  state.roles.forEach(role=>{
    const label = document.createElement('label'); label.style.display='inline-flex'; label.style.alignItems='center'; label.style.gap='6px';
    label.innerHTML = `<input type="checkbox" value="${role}"> ${role}`; rolesArea.appendChild(label);
  });
  $('#memberName').value = '';
  $('#memberStatus').value = 'frequente';
  if(editing){
    const m = state.members.find(x=>x.id===id);
    if(m){
      $('#memberName').value = m.name; $('#memberStatus').value = m.status;
      $$('#rolesArea input[type=checkbox]').forEach(cb=>cb.checked = m.roles.includes(cb.value));
    }
  }
  dlg.showModal();
  dlg.addEventListener('close', ()=>{
    if(dlg.returnValue==='default'){
      const name = $('#memberName').value.trim();
      const status = $('#memberStatus').value;
      const roles = $$('#rolesArea input:checked').map(cb=>cb.value);
      if(!name) return;
      if(editing){
        const i = state.members.findIndex(x=>x.id===id); if(i>-1){ state.members[i] = {...state.members[i], name, status, roles}; }
        // \u27a4 Backend real: PUT /api/members/:id
      } else {
        state.members.push({ id: crypto.randomUUID(), name, status, roles, createdAt: fmt.date(new Date()) });
        // \u27a4 Backend real: POST /api/members
      }
      storage.save(); renderMembers();
    }
  }, {once:true});
}

// ======= Lista de Presença =======
function sundaysAround(startDate=new Date(), weeks=52){
  // gera últimos e próximos domingos
  const dates = new Set();
  const start = new Date(startDate);
  for(let i=-weeks;i<=weeks;i++){
    const d = new Date(start); d.setDate(d.getDate()+i*7);
    // Ajusta para domingo (0)
    const delta = d.getDay(); // 0..6
    d.setDate(d.getDate()-delta); // volta até domingo
    dates.add(fmt.date(d));
  }
  return Array.from(dates).sort();
}
function renderAttendanceDates(){
  const sel = $('#attendanceDate'); sel.innerHTML='';
  sundaysAround(new Date(), 60).forEach(iso=>{
    const o = document.createElement('option'); o.value = iso; o.textContent = new Date(iso).toLocaleDateString(); sel.appendChild(o);
  });
}
$('#btnLoadAttendance').addEventListener('click', ()=>{
  const date = $('#attendanceDate').value; loadAttendance(date); renderAttendanceTable(date);
});
$('#btnSaveAttendance').addEventListener('click', ()=>{
  const date = $('#attendanceDate').value; if(!date) return;
  // \u27a4 Backend real: PUT /api/attendance/:date { entries }
  storage.save();
  alert('Presenças salvas para '+ new Date(date).toLocaleDateString());
});

function loadAttendance(date){
  // \u27a4 Backend real: GET /api/attendance?date=YYYY-MM-DD
  if(!state.attendanceByDate[date]) state.attendanceByDate[date] = {};
}
function renderAttendanceTable(date){
  const tbody = $('#attendanceTable tbody');
  tbody.innerHTML='';
  const map = state.attendanceByDate[date]||{};
  // Apenas membros não-afastados aparecem; licença aparece como inativo
  const list = state.members.filter(m=>m.status!== 'afastado');
  list.sort((a,b)=>a.name.localeCompare(b.name));
  list.forEach(m=>{
    const current = map[m.id] || 'P'; // default Presente
    const tr = document.createElement('tr');
    const disabled = m.status==='licenca';
    tr.innerHTML = `
      <td data-label="Nome">${m.name}</td>
      <td data-label="Situação">${{
        'frequente':'Frequente', 'afastado':'Afastado', 'licenca':'Licença'
      }[m.status]}</td>
      <td data-label="Presença">
        <div class="row" style="gap:8px;align-items:center">
          <button class="btn" data-cycle="${m.id}" ${disabled?'disabled':''}>${renderPresenceLabel(current)}</button>
          <span class="muted">(clique para alternar)</span>
        </div>
      </td>`;
    tbody.appendChild(tr);
  });
  $$('button[data-cycle]').forEach(btn=>btn.addEventListener('click',()=>{
    const id = btn.dataset.cycle; const next = cyclePresence(getPresence(date,id)); setPresence(date,id,next); btn.textContent = renderPresenceLabel(next);
  }));
}
function renderPresenceLabel(code){
  // Regras do enunciado: checkbox triestado (vazio=Presente, preenchido=Falta, FJ=Falta Justificada)
  // Aqui usamos um botão que alterna os estados mantendo o conceito visual (P/F/FJ)
  return ({'P':'Presente','F':'Falta','FJ':'Falta Justificada'})[code] || 'Presente';
}
function cyclePresence(code){
  return code==='P' ? 'F' : code==='F' ? 'FJ' : 'P';
}
function getPresence(date, memberId){
  const map = state.attendanceByDate[date]||{}; return map[memberId]||'P';
}
function setPresence(date, memberId, value){
  if(!state.attendanceByDate[date]) state.attendanceByDate[date] = {}; state.attendanceByDate[date][memberId]=value;
}

// ======= Filtros =======
function renderFilterDates(){
  const sel = $('#filterDate'); sel.innerHTML='';
  sundaysAround(new Date(), 60).forEach(iso=>{
    const o = document.createElement('option'); o.value = iso; o.textContent = new Date(iso).toLocaleDateString(); sel.appendChild(o);
  });
}
$('#btnRunFilters').addEventListener('click', ()=>{
  const date = $('#filterDate').value; const pres = $('#filterPresence').value; const name = $('#filterName').value.toLowerCase(); const role = $('#filterRole').value.toLowerCase();
  const tbody = $('#filtersResult tbody'); tbody.innerHTML='';
  const map = state.attendanceByDate[date]||{};
  const data = state.members
    .filter(m=> m.name.toLowerCase().includes(name))
    .filter(m=> !role || m.roles.some(r=>r.toLowerCase().includes(role)))
    .map(m=> ({ m, presence: map[m.id]||'P' }))
    .filter(row=> !pres || row.presence===pres);
  data.forEach(({m,presence})=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td data-label="Data">${new Date(date).toLocaleDateString()}</td>
      <td data-label="Nome">${m.name}</td>
      <td data-label="Cargos">${m.roles.join(', ')||'—'}</td>
      <td data-label="Presença">${renderPresenceLabel(presence)}</td>`;
    tbody.appendChild(tr);
  });
});

// ======= Inicialização =======
(function init(){
  ensureSeed(); storage.load(); renderNav(); renderUserBox(); navigate();
})();
</script>
</body>
</html>
